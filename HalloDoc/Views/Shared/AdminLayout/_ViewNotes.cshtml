@model Services.ViewModels.ViewNotesModel;
<div class="main">
    <div class="back container mt-3 d-flex justify-content-between">
        <h3 class="mt-2 fw-bold">Notes</h3>
        <a style="text-decoration: none;cursor:pointer" class="backimg">
            <img src="~/images/image_2024_01_17T04_17_17_757Z.png" alt="">
            <span>Back</span>
        </a>
    </div>
    <div class="container" style="padding-bottom:20px" id="maincontent">
        <div class="notesicon">
            <div class="row row-cols-md-2 row-cols-sm-1 row-cols-1 mt-3">
                <div class="col">
                    <div class=" bg-white lightmode p-2 border border-black rounded" style="min-height:80px">
                        <div class="fw-semibold">
                            <i class="fa-solid fa-right-left me-2"></i> Transfer Notes
                        </div>
                        <div style="margin-left : 27px">
                            @if (@Model.requeststatuslogs != null)
                            {
                                <span>
                                    @Model.adminname
                                    transferred to @Model.phyname on @Model.requeststatuslogs.Createddate.Date at @Model.requeststatuslogs.Createddate.TimeOfDay : @Model.requeststatuslogs.Notes
                                </span>
                            }
                            else
                            {
                                <span>-</span>
                            }
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class=" bg-white lightmode p-2 mt-md-0 mt-sm-2 mt-2 border border-black rounded" style="min-height:80px">
                        <div class="fw-semibold">
                            <i class="fa-solid fa-user-doctor me-2"></i>Physican Notes
                        </div>
                        <div style="margin-left : 25px">
                            @Model.physiciannotes
                        </div>
                    </div>
                </div>
                <div class="col mt-2">
                    <div class=" bg-white lightmode p-2 border border-black rounded" style="min-height:80px">
                        <div class="fw-semibold">
                            <i class="fa-solid fa-user-tie me-2"></i>Admin Notes
                        </div>
                        <div style="margin-left : 25px">
                            @Model.adminnotes
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <form>
            <div class="mt-3 bg-white lightmode p-2">
                <input asp-for="@Model.reqid" type="hidden">
                <div class="form-floating d-none" id="foradmin">
                    <textarea asp-for="@Model.adminnotes" class="form-control" placeholder="Leave a comment here" id="adminnotes"
                              style="height: 100px;"></textarea>
                    <label for="floatingTextarea" class="medialabel">Admin Notes</label>
                </div>
                <div class="form-floating d-none" id="forphysician">
                    <textarea asp-for="@Model.physiciannotes" class="form-control" placeholder="Leave a comment here" id="physiciannotes"
                              style="height: 100px;"></textarea>
                    <label for="floatingTextarea" class="medialabel">Physician Notes</label>
                </div>
                <div class="d-flex justify-content-end">
                    <button type="button" class="btn btn-info text-white mt-3" id="SaveChanges">Save Changes</button>
                </div>
            </div>
        </form>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    dark();
    var phynotes = false;
    $.ajax({
        url: '/Physician/CheckSession',
        success: function (response) {
            if (response == true) {
                $('#forphysician').removeClass('d-none');
                phynotes = true;
            }
            else {
                $('#foradmin').removeClass('d-none');
            }
        },
        error: function (xhr, status, error) {
            console.error(error);
        }
    });
    $('#SaveChanges').on('click', function () {
        $('#ViewcaseRemove').removeClass("d-flex").addClass("d-none");
        console.log(phynotes);
        if (phynotes == false) {
            $.ajax({
                type: 'POST',
                url: '/Admin/AdminNotesSaveChanges',
                data: { "reqid": @Model.reqid , "adminnotes": $('#adminnotes').val() },
                success: function (response) {
                    $('#alldata').html(response);
                    console.log("Fetch success");
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        }
        else {
            $.ajax({
                type: 'POST',
                url: '/Physician/PhysicianNotesSaveChanges',
                data: { "reqid": @Model.reqid , "physiciannotes": $('#physiciannotes').val() },
                success: function (response) {
                    $('#alldata').html(response);
                    console.log("Fetch success");
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        }
    });
    $('.backimg').on('click', function () {
        $.ajax({
            success: function (response) {
                window.location.reload();
            },
            error: function (xhr, status, error) {
                console.error(error);
            }
        });
    });
</script>