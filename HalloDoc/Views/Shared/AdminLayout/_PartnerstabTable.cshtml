@using Common.Helper;
@model Services.ViewModels.PartnersModal
<table class="table p-2">
    <thead class="table-secondary">
        <tr>
            <th scope="col">Profession</th>
            <th scope="col">Business Name</th>
            <th scope="col">Email</th>
            <th scope="col">Fax Number</th>
            <th scope="col">Phone Number</th>
            <th scope="col" class="text-center">Business Contact</th>
            <th scope="col">Actions</th>
        </tr>
    </thead>
    <tbody id="myTable">
        @foreach (var obj in Model.healthprofessionals)
        {
            var professiontype = Model.healthprofessionaltypes.FirstOrDefault(u => u.Healthprofessionalid == obj.Profession)!.Professionname;
            <tr>
                <td>@professiontype</td>
                <td>@obj.Vendorname</td>
                <td>@obj.Email</td>
                <td>@obj.Faxnumber</td>
                <td>@obj.Phonenumber</td>
                <td class="text-center">
                    @if (@obj.Businesscontact == null)
                    {
                        <span>@obj.Businesscontact</span>
                    }
                    else
                    {
                        <span>-</span>
                    }
                </td>
                <td>
                    <a asp-action="EditBusiness" asp-controller="Admin" asp-route-id="@EncryptDecryptHelper.Encrypt(@obj.Vendorid.ToString())" class="btn btn-outline-info me-1 boxshadowbtn">Edit</a>
                    <a value="@obj.Vendorid" class="btn btn-outline-info boxshadowbtn deletebtn">Delete</a>
                </td>
            </tr>
        }
    </tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    $('.deletebtn').on('click', function (e) {
        var id = $(this).attr("value");
        swal.fire({
            title: "Are you sure?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes",
            closeOnConfirm: false
        }).then(function (result) {
            if (result.value) {
                $.ajax({
                    url: '/Admin/DeleteBusiness',
                    data: { "id": id },
                    success: function (response) {
                        var link = document.createElement('a');
                        link.href = "/Admin/PartnersTab";
                        link.click();
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                    }
                });
            } else {
                console.log('Cancelled!');
            }
        });
    });
</script>
