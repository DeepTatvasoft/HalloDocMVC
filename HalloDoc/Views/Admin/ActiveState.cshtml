@{
    Layout = "";
}
@model Services.ViewModels.NewStateData
<style>
    .accordion-button::after {
        content: none;
    }

    .icn::before {
        border: 2px solid #0dcaf0;
        border-radius: 50%;
        line-height: 1;
        font-size: 13px;
        padding: 3px;
    }

    .icns::before {
        font-weight: 900 !important;
    }
</style>

<div class="container-fluid" id="alldata">
    <div class="d-flex flex-wrap justify-content-between">
        <h4 class="mt-2">Patients (New)</h4>
        <div class="allbtn d-flex">
            <button class="btn btn-info text-white ms-1 d-flex align-items-center">
                <i class="bi bi-send me-1"></i>
                <span class="d-none d-md-block">
                    Send Link
                </span>
            </button>
            <button class="btn btn-info text-white ms-1 d-flex align-items-center">
                <i class="bi bi-journal-text me-1"></i>
                <span class="d-none d-md-block">
                    Create Request
                </span>
            </button>
            <button class="btn btn-info text-white ms-1 d-flex align-items-center">
                <i class="fa-solid fa-file-export me-1"></i>
                <span class="d-none d-md-block">
                    Export
                </span>
            </button>
            <button class="btn btn-info text-white ms-1 d-flex align-items-center">
                <i class="fa-solid fa-file-zipper me-1"></i>
                <span class="d-none d-md-block">
                    Export All
                </span>
            </button>
            <button class="btn btn-info text-white ms-1 d-flex align-items-center">
                <i class="fa-solid fa-headset me-1"></i>
                <span class="d-none d-md-block">
                    Request DIY Support
                </span>
            </button>
        </div>
    </div>
    <div class="tablehead mt-4 d-flex flex-wrap justify-content-between bg-white">
        <div class="d-flex flex-wrap align-items-center">
            <div class="searchbar ms-2">
                <input id="myInput" style="padding-left : 30px;position: relative;top: 13px;" class="form-control me-2" type="search" placeholder=" Search Patients" aria-label="Search">
                <i class="bi bi-search searchicon1"></i>
            </div>
            <div class="ms-2">
                <datalist id="suggestions">
                    <option id="uk">United Kingdom</option>
                    <option id="uae">Dubai</option>
                    <option id="ny">New York</option>
                </datalist>
                <input class="region" autoComplete="on" list="suggestions" placeholder="All Region" />
                <i class="bi bi-search searchicon2"></i>
                <i class="fa-solid fa-chevron-down down"></i>
            </div>
        </div>
        <div class="d-flex flex-wrap mt-3">
            <div type="radio" class="border border-secondary-subtle all ms-3 mb-3 me-3 requestby d-none d-md-inline-block" id="requestbyAll" style="cursor : pointer">
                All
            </div>
            <div class="d-flex flex-wrap">
                <div class="ms-3 me-3 requestby" id="1" style="cursor : pointer"><span class="dot" style="Background-color : green;"></span> Patient</div>
                <div class="ms-3 me-3 requestby" id="2" style="cursor : pointer"><span class="dot" style="Background-color : darkorange;"></span> Family/Friend</div>
                <div class="ms-3 me-3 requestby" id="3" style="cursor : pointer"><span class="dot" style="Background-color : hotpink;"></span> Business</div>
                <div class="ms-3 me-3 requestby" id="4" style="cursor : pointer"><span class="dot" style="Background-color : dodgerblue;"></span> Concierge</div>
                <div class="ms-3 me-3 requestby" id="5" style="cursor : pointer"><span class="dot" style="Background-color : mediumpurple;"></span> Vip</div>
            </div>
        </div>

    </div>
    <div id="status-tabContent">
        <div class="table-responsive text-white mt-3" style="height:100%;">
            <table class="table d-none d-md-table" id="maintable">
                <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col"> </th>
                        <th scope="col">Date Of Birth</th>
                        <th scope="col">Requestor</th>
                        <th scope="col">Physician Name</th>
                        <th scope="col">Date Of Service</th>
                        <th scope="col">Phone</th>
                        <th scope="col">Address</th>
                        <th scope="col">Notes</th>
                        <th scope="col">Chat With</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody style="--bs-table-color: white;" id="myTable">
                    @foreach (var obj in Model.req)
                    {
                        var reqclient = obj.Requestclients.ElementAt(0);
                        var reqstatuslog = obj.Requeststatuslogs.ElementAt(0);
                        var color = "mediumpurple";
                        var type = "";
                        @if (obj.Requesttypeid == 1)
                        {
                            color = "rgb(72 169 70)";
                            type = "Patient";
                        }
                        else if (obj.Requesttypeid == 2)
                        {
                            color = "#f5a33e";
                            type = "Family";
                        }
                        else if (obj.Requesttypeid == 4)
                        {
                            color = "hotpink";
                            type = "Business";
                        }
                        else if (obj.Requesttypeid == 3)
                        {
                            color = "dodgerblue";
                            type = "Concierge";
                        }
                        <tr style="--bs-table-bg:@color">
                            <td scope="row">@reqclient.Firstname, @reqclient.Lastname</td>
                            <td scope="row">
                                <button type="button" class="btn btn-outline-light"><i class="fa-regular fa-envelope"></i></button>
                            </td>
                            <td scope="row">@reqclient.Strmonth-@reqclient.Intdate-@reqclient.Intyear</td>
                            <td scope="row">@obj.Firstname , @obj.Lastname</td>
                            <td scope="row">@obj.Physician.Firstname</td>
                            <td scope="row">@obj.Modifieddate</td>
                            <td scope="row">
                                <div class="phone">@reqclient.Phonenumber</div>
                                (Patient)
                                @if (type != "Patient")
                                {
                                    <div class="phone">@obj.Phonenumber</div>
                                    <span>(@type)</span>
                                }
                            </td>
                            <td scope="row">@reqclient.Address</td>
                            <td scope="row">@reqstatuslog.Notes</td>
                            <td scope="row">
                                <button class="btn btn-outline-light"><i class="fa-solid fa-user-injured me-1"></i>Patient</button>
                                <button class="btn btn-outline-light"><i class="bi bi-person me-1"></i>Provider</button>
                            </td>
                            <td scope="row">
                                <div class="dropdown ms-2">
                                    <button class="btn btn-outline-light" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        Actions
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li style="cursor : pointer"><a class="dropdown-item text-secondary viewcase" id="@obj.Requestid"><i class="bi bi-view-list me-2"></i>View case</a></li>
                                        <li style="cursor : pointer"><a class="dropdown-item text-secondary viewuploads" name="@obj.Requestid"><i class="fa-regular fa-file me-2"></i>View Uploads</a></li>
                                        <li>
                                            <a class="dropdown-item text-secondary viewnotes" name="@obj.Requestid">
                                                <i class="fa-solid fa-book-journal-whills me-2"></i>View Notes
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item text-secondary sendorder" name="@obj.Requestid" href="#">
                                                <i class="fa-solid fa-cart-shopping me-2"></i>Orders
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item text-secondary" href="#">
                                                <i class="fa-solid fa-notes-medical me-2"></i>Doctor's Note
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item text-secondary" href="#">
                                                <i class="fa-solid fa-file me-2"></i>Encounter
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <div class="d-none d-md-flex justify-content-center gap-3">
                @if (Model.totalpages > 0)
                {
                    var x = 0;
                    if (Model.totalpages % 7 == 0)
                    {
                        x = 0;
                    }
                    else
                    {
                        x = 1;
                    }
                    @for (int page = 0; page < (Model.totalpages / 7) + x; page++)
                    {
                        var temp = page + 1;
                        <button class="@temp" id="page-@temp" onclick="ChangePage(@temp,4)" style="width:25px">
                            @temp
                        </button>
                    }
                }
            </div>

            <div class="accordion accordion-flush d-md-none d-block" id="accordionFlushExample">

                <div class="accordion-item">
                    @foreach (var item in Model.req)
                    {
                        var reqclient = item.Requestclients.ElementAt(0);
                        var reqstatuslog = item.Requeststatuslogs.ElementAt(0);
                        var type = "";
                        var color = "mediumpurple";
                        @if (item.Requesttypeid == 1)
                        {
                            color = "rgb(72 169 70)";
                            type = "Patient";
                        }
                        else if (item.Requesttypeid == 2)
                        {
                            color = "#f5a33e";
                            type = "Family";
                        }
                        else if (item.Requesttypeid == 4)
                        {
                            color = "hotpink";
                            type = "Business";
                        }
                        else if (item.Requesttypeid == 3)
                        {
                            color = "dodgerblue";
                            type = "Concierge";
                        }
                        <h2 class="accordion-header" id="flush-headingOne">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseone-@item.Requestid" aria-expanded="false" aria-controls="flush-collapseOne" style="background-color:#e7f1ff; color:black">

                                <div class="col d-flex flex-column">
                                    <span class="">@reqclient.Firstname, @reqclient.Lastname</span>
                                    <span class=" mt-4">@reqclient.Address</span>
                                </div>
                                <div class="col d-flex flex-column text-end mt-2 p-0">
                                    <div>
                                        <div>
                                            <div class="ms-3" id="1">@type<span class="dot ms-2" style="Background-color :@color;"></span></div>
                                        </div>
                                        <div class=" btn rounded-pill text-info border-info float-end p-1 mt-3" style="width:120px">
                                            Map Location
                                        </div>
                                    </div>
                                </div>
                            </button>
                            <hr class="m-0">
                        </h2>
                        <div id="flush-collapseone-@item.Requestid" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample" style="background-color:#e7f1ff; color:black">
                            <button type="button" class="btn btn-outline-light text-black float-end viewcase bg-white rounded-5 border border-black mt-1" id="@item.Requestid">View Case</button>
                            <div class="accordion-body d-flex flex-column gap-1 w-100">
                                <div><i class="bi bi-calendar2-minus me-1 icn"></i>Date of birth: @reqclient.Strmonth-@reqclient.Intdate-@reqclient.Intyear</div>
                                <div><i class="bi bi-envelope me-1 icn"></i>Email: @reqclient.Email</div>
                                <div>
                                    <i class="bi bi-telephone me-1 icn"></i>Patient: @reqclient.Phonenumber
                                </div>
                                <div>
                                    <i class="fa-solid fa-arrow-right-arrow-left icn me-1"></i>Transfer Notes: @reqstatuslog.Notes
                                </div>
                                <div>
                                    <i class="fa-regular fa-calendar-days icn me-1"></i>Date Of Services: @item.Modifieddate
                                </div>
                                <div>
                                    <i class="fa-solid fa-user-doctor me-1 icn"></i>Physician: @item.Physician.Firstname
                                </div>
                                <div><i class="bi bi-person me-1 icn"></i>Requestor: @item.Firstname, @item.Lastname</div>
                            </div>
                            <div class="row mx-3">
                                <div class="col-6 mb-2">
                                    <a class="btn w-100 text-white rounded-pill p-1 btn-sm viewnotes" name="@item.Requestid" style="background-color:green;font-size:13px">View Notes</a>
                                </div>
                                <div class="col-6 mb-2">
                                    <a class="btn w-100 bg-success text-white rounded-pill p-1 btn-sm" style="font-size:13px">Doctors Note</a>
                                </div>
                                <div class="col-6 mb-2">
                                    <a class="btn w-100 text-white rounded-pill p-1 btn-sm viewuploads" name="@item.Requestid" style="background-color:green;font-size:13px">View Uploads</a>
                                </div>
                                <div class="col-6 mb-2">
                                    <a class="btn w-100 text-white rounded-pill p-1 btn-sm" style="background-color:green;font-size:13px">Encounter</a>
                                </div>
                                <div class="col-6 mb-2">
                                    <a class="btn w-100 text-white rounded-pill p-1 btn-sm sendorder" name="@item.Requestid" style="background-color:orangered;font-size:13px">Orders</a>
                                </div>
                                <div class="col-6 mb-2">
                                    <a class="btn w-100 text-white rounded-pill p-1 btn-sm" style="background-color:green;font-size:13px">Email</a>
                                </div>
                            </div>
                            <div class="mt-2 me-sm-4 d-flex justify-content-end align-items-center">
                                <span class="me-2">Chat With:</span>
                                <button class="btn btn-outline-info btn-sm me-2"><i class="fa-solid fa-user-injured me-1"></i>Patient</button>
                                <button class="btn btn-outline-info btn-sm"><i class="bi bi-person me-1"></i>Provider</button>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $("#myInput").on("input", function () {
            var value = $(this).val().toLowerCase();
            $("#myTable tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
        $("#myInput").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#myTable tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
        $('.requestby').on('click', function (e) {
            e.preventDefault();
            //$('.dashboardtab').removeClass('active');
            //$(this).addClass('active');
            var target = $(this).attr('id');
            console.log(target);
            var status;
            var requesttype;
            switch (target) {
                case '1':
                    status = '4';
                    requesttype = '1';
                    break;
                case '2':
                    status = '4';
                    requesttype = '2';
                    break;
                case '3':
                    status = '4';
                    requesttype = '4';
                    break;
                case '4':
                    status = '4';
                    requesttype = '3';
                    break;
                default:

            }

            $.ajax({
                url: '/Admin/ActiveState',
                data: { "status": status, "reqtypeid": requesttype },
                success: function (response) {
                    $('#status-tabContent').html(response);
                    document.getElementById("page-1").style.backgroundColor = "lightblue";
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        });
        $('.region').on('change', function (e) {

            var target = $('.region').val();
            console.log(target);
            $('.region').value = target;
            $(".region").attr("placeholder", "variable")
            switch (target) {
                case 'United Kingdom':
                    status = '4';
                    regionid = '3';
                    break;
                case 'Dubai':
                    status = '4';
                    regionid = '2';
                    break;
                case 'New York':
                    status = '4';
                    regionid = '1';
                    break;
                default:
            }
            $.ajax({
                url: '/Admin/ActiveState',
                data: { "status": status, "regionid": regionid },
                success: function (response) {
                    $('#status-tabContent').html(response);
                    document.getElementById("page-1").style.backgroundColor = "lightblue";
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        });
        $('.viewcase').on('click', function (e) {
            e.preventDefault();
            //$('.dashboardtab').removeClass('active');
            //$(this).addClass('active');
            var id = $(this).attr('id');
            $.ajax({
                url: '/Admin/ViewCase',
                data: { "id": id },
                success: function (response) {
                    $('#home-tab-pane').html(response);
                    console.log("Fetch success");
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        });
        $('.viewnotes').on('click', function (e) {
            e.preventDefault();
            //$('.dashboardtab').removeClass('active');
            //$(this).addClass('active');
            var reqid = $(this).attr('name');
            $.ajax({
                url: '/Admin/ViewNotes',
                data: { "reqid": reqid },
                success: function (response) {
                    $('#home-tab-pane').html(response);
                    console.log("Fetch success");
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        });
        $('.viewuploads').on('click', function (e) {
            e.preventDefault();
            //$('.dashboardtab').removeClass('active');
            //$(this).addClass('active');
            var reqid = $(this).attr('name');
            //console.log(reqid);
            console.log($('#ViewcaseRemove').attr('id'));
            $('#ViewcaseRemove').removeClass("d-flex").addClass("d-none");
            //$('#myTab').remove();

            $.ajax({
                url: '/Admin/AdminuploadDoc',
                data: { "reqid": reqid },
                success: function (response) {
                    $('#home-tab-pane').html(response);
                    console.log("Fetch success");
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        });
        $('.sendorder').on('click', function (e) {
            e.preventDefault();
            var reqid = $(this).attr('name');
            $.ajax({
                url: '/Admin/Orders',
                data: { "reqid": reqid },
                success: function (response) {
                    $('#home-tab-pane').html(response);
                    console.log("Fetch success");
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        });
    });
</script>
